<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MT Variedades | Business Suite</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --sidebar-bg: #0f172a;
            --main-bg: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --success: #10b981;
            --danger: #ef4444;
            --shadow: 0 10px 25px -5px rgba(0,0,0,0.05);
            --radius: 18px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background-color: var(--main-bg); display: flex; height: 100vh; color: var(--text-main); overflow: hidden; }

        /* --- SIDEBAR --- */
        #sidebar { 
            width: 290px; background: var(--sidebar-bg); color: white; 
            display: flex; flex-direction: column; padding: 25px;
            box-shadow: 10px 0 30px rgba(0,0,0,0.1); z-index: 10;
        }
        .logo { 
            padding-bottom: 30px; font-size: 1.6rem; font-weight: 800; 
            letter-spacing: -1px; color: var(--primary); display: flex; align-items: center; gap: 10px;
        }
        .nav-link { 
            width: 100%; padding: 14px 20px; background: transparent; border: none; 
            color: #94a3b8; text-align: left; cursor: pointer; display: flex; 
            align-items: center; gap: 12px; border-radius: 14px; margin-bottom: 8px; 
            transition: 0.3s; font-weight: 500;
        }
        .nav-link:hover { background: rgba(255,255,255,0.05); color: white; transform: translateX(5px); }
        .nav-link.active { background: var(--primary); color: white; box-shadow: 0 15px 25px -5px rgba(99, 102, 241, 0.4); }

        .creditos-sidebar { margin-top: auto; padding-top: 20px; font-size: 0.75rem; color: #64748b; border-top: 1px solid rgba(255,255,255,0.1); }
        .creditos-sidebar b { color: white; display: block; }

        /* --- HEADER --- */
        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 30px; background: white; padding: 15px 30px;
            border-radius: var(--radius); box-shadow: var(--shadow);
        }
        #live-clock { font-size: 1.4rem; font-weight: 800; }
        #live-date { font-size: 0.85rem; color: var(--text-sub); text-transform: capitalize; }

        /* --- CONTENT --- */
        #main { flex: 1; padding: 30px 40px; overflow-y: auto; position: relative; }
        .page { display: none; max-width: 1200px; margin: 0 auto; animation: slideUp 0.4s ease; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--card-bg); border-radius: var(--radius); padding: 30px; box-shadow: var(--shadow); margin-bottom: 30px; }
        
        /* --- TABLES --- */
        table { width: 100%; border-collapse: separate; border-spacing: 0 8px; }
        th { padding: 12px; color: var(--text-sub); font-size: 0.7rem; text-transform: uppercase; text-align: left; }
        td { padding: 15px; background: white; border-top: 1px solid #f1f5f9; border-bottom: 1px solid #f1f5f9; }
        tr td:first-child { border-left: 1px solid #f1f5f9; border-radius: 12px 0 0 12px; }
        tr td:last-child { border-right: 1px solid #f1f5f9; border-radius: 0 12px 12px 0; }

        /* --- INPUTS --- */
        .search-box { width: 100%; padding: 15px 20px; border-radius: 12px; border: 2px solid #f1f5f9; font-size: 1rem; margin-bottom: 20px; transition: 0.3s; }
        .search-box:focus { border-color: var(--primary); outline: none; background: white; }
        .btn { padding: 15px 25px; border: none; border-radius: 12px; cursor: pointer; font-weight: 700; transition: 0.3s; text-transform: uppercase; font-size: 0.8rem; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-success { background: var(--success); color: white; }
        
        #pay-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); display: none; align-items: center; justify-content: center; z-index: 1000; }
    </style>
</head>
<body>

    <aside id="sidebar">
        <div class="logo">MT <span>VARIEDADES</span></div>
        <button class="nav-link active" onclick="nav('pdv')">üõí Venda R√°pida</button>
        <button class="nav-link" onclick="nav('estoque')">üì¶ Estoque</button>
        <button class="nav-link" onclick="nav('historico')">üìä Faturamento</button>
        <button class="nav-link" onclick="nav('fiado')">ü§ù Devedores</button>
        <button class="nav-link" onclick="nav('cadastro')">‚ú® Cadastrar Item</button>
        <button class="nav-link" onclick="nav('backup')">üõ°Ô∏è Backup</button>
        <button class="nav-link" onclick="nav('ajustes')">üé® Visual</button>

        <div class="creditos-sidebar">
            Desenvolvido por:
            <b>Alisson Santos Rodrigues</b>
            <a href="https://instagram.com/alissonnxss" target="_blank" style="color:var(--primary); text-decoration:none;">@alissonnxss</a>
        </div>
    </aside>

    <main id="main">
        <header class="top-bar">
            <h2 id="page-title">Frente de Caixa</h2>
            <div style="text-align: right;">
                <div id="live-clock">00:00:00</div>
                <div id="live-date">...</div>
            </div>
        </header>

        <section id="pg-pdv" class="page active">
            <div style="display: grid; grid-template-columns: 1fr 350px; gap: 25px;">
                <div class="card">
                    <input type="text" class="search-box" id="pos-search" placeholder="Buscar produto..." onkeyup="doSearch(this.value)">
                    <div id="pos-results" style="position:absolute; background:white; width:40%; z-index:100; border-radius:12px; box-shadow: var(--shadow);"></div>
                    <table>
                        <thead><tr><th>Produto</th><th>Pre√ßo</th><th>Qtd</th><th>Total</th><th>#</th></tr></thead>
                        <tbody id="pos-cart"></tbody>
                    </table>
                </div>
                <div class="card" style="background: #0f172a; color: white; height: fit-content;">
                    <small>TOTAL DA VENDA</small>
                    <div style="font-size: 2.5rem; font-weight: 800; color: var(--success); margin: 10px 0;" id="pos-total">R$ 0,00</div>
                    <button class="btn btn-primary" style="width:100%" onclick="openPayModal()">FINALIZAR</button>
                </div>
            </div>
        </section>

        <section id="pg-estoque" class="page">
            <div class="card">
                <table>
                    <thead><tr><th>ID</th><th>Nome</th><th>Custo</th><th>Venda</th><th>Estoque</th><th>#</th></tr></thead>
                    <tbody id="stock-list"></tbody>
                </table>
            </div>
        </section>

        <section id="pg-fiado" class="page">
            <div class="card">
                <h3 style="margin-bottom: 20px;">ü§ù Lista de Devedores</h3>
                <table>
                    <thead><tr><th>Cliente</th><th>D√≠vida Atual (R$)</th><th style="text-align: right;">A√ß√µes</th></tr></thead>
                    <tbody id="debt-list"></tbody>
                </table>
            </div>

            <div class="card" style="background: #f8fafc; border: 2px dashed #eee; margin-top: 50px;">
                <h4 style="margin-bottom: 15px; color: var(--text-sub);">‚ûï Lan√ßar Valor por Fora</h4>
                <div style="display: flex; gap: 15px;">
                    <input type="text" id="manual-debt-name" class="search-box" style="margin:0; flex: 2;" placeholder="Nome do Cliente">
                    <input type="number" id="manual-debt-value" class="search-box" style="margin:0; flex: 1;" placeholder="Valor R$">
                    <button class="btn btn-primary" onclick="addManualDebt()">LAN√áAR</button>
                </div>
            </div>
        </section>

        <section id="pg-historico" class="page">
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div class="card" style="background: var(--primary); color: white; margin: 0;">
                    <small>BRUTO</small>
                    <h2 id="fat-bruto">R$ 0,00</h2>
                </div>
                <div class="card" style="background: var(--success); color: white; margin: 0;">
                    <small>LUCRO</small>
                    <h2 id="fat-lucro">R$ 0,00</h2>
                </div>
            </div>
            <div class="card">
                <table>
                    <thead><tr><th>Data</th><th>Itens</th><th>Total</th><th>Tipo</th><th>#</th></tr></thead>
                    <tbody id="hist-list"></tbody>
                </table>
            </div>
        </section>

        <section id="pg-cadastro" class="page">
            <div class="card" style="max-width: 500px; margin: auto;">
                <input type="text" id="cad-nome" class="search-box" placeholder="Nome">
                <input type="text" id="cad-id" class="search-box" placeholder="SKU/C√≥digo">
                <input type="number" id="cad-qtd" class="search-box" placeholder="Qtd">
                <input type="number" id="cad-custo" class="search-box" placeholder="Custo R$">
                <input type="number" id="cad-venda" class="search-box" placeholder="Venda R$">
                <button class="btn btn-primary" style="width: 100%;" onclick="saveProd()">SALVAR PRODUTO</button>
            </div>
        </section>

        <section id="pg-backup" class="page">
            <div class="card" style="max-width: 500px; margin: auto; text-align: center;">
                <h3 style="margin-bottom: 20px;">Seguran√ßa dos Dados</h3>
                <button class="btn btn-success" style="width: 100%; margin-bottom: 15px;" onclick="exportDados()">üíæ BAIXAR BACKUP AGORA</button>
                <button class="btn" style="width: 100%; background: #eee;" onclick="document.getElementById('importFile').click()">üìÇ RESTAURAR ARQUIVO</button>
                <input type="file" id="importFile" style="display:none" onchange="importDados(event)">
            </div>
        </section>

        <section id="pg-ajustes" class="page">
            <div class="card">
                <h3>Cor do Sistema</h3>
                <div id="color-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap:15px; margin-top:20px;"></div>
            </div>
        </section>

        <footer style="text-align: center; padding: 60px 0; color: var(--text-sub); font-size: 0.8rem; border-top: 1px solid #eee; margin-top: 40px;">
            <b>MT Variedades</b> | Sistema Desenvolvido por <b>Alisson Santos Rodrigues</b><br>
            <a href="https://instagram.com/alissonnxss" target="_blank" style="color:var(--primary); text-decoration: none; font-weight: 700;">@alissonnxss</a>
        </footer>
    </main>

    <div id="pay-modal">
        <div class="card" style="width: 350px; text-align: center;">
            <h3 style="margin-bottom: 20px;">Pagamento</h3>
            <button class="btn" style="width:100%; background:#f1f5f9; margin-bottom:10px;" onclick="completeSale('Dinheiro')">Dinheiro</button>
            <button class="btn" style="width:100%; background:#f1f5f9; margin-bottom:10px;" onclick="completeSale('Cart√£o')">Cart√£o</button>
            <button class="btn" style="width:100%; background:#f1f5f9; margin-bottom:10px;" onclick="completeSale('Pix')">Pix</button>
            <button class="btn" style="width:100%; background:#fffbeb; color:#92400e;" onclick="completeSale('Fiado')">Anotar Fiado</button>
            <button class="btn" style="background:none; color:red; margin-top:10px;" onclick="closeModal()">Cancelar</button>
        </div>
    </div>

    <script>
        let prods = JSON.parse(localStorage.getItem('mt_p')) || [];
        let sales = JSON.parse(localStorage.getItem('mt_v')) || [];
        let debts = JSON.parse(localStorage.getItem('mt_f')) || [];
        let cart = [];

        // HORA
        setInterval(() => {
            const now = new Date();
            document.getElementById('live-clock').innerText = now.toLocaleTimeString('pt-BR');
            document.getElementById('live-date').innerText = now.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
        }, 1000);

        function nav(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('pg-' + id).classList.add('active');
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            const titles = { 'pdv': 'Frente de Caixa', 'estoque': 'Estoque', 'historico': 'Faturamento', 'fiado': 'Devedores', 'cadastro': 'Novo Item', 'backup': 'Backup', 'ajustes': 'Visual' };
            document.getElementById('page-title').innerText = titles[id];

            if(id === 'estoque') renderStock();
            if(id === 'historico') renderHistory();
            if(id === 'fiado') renderDebts();
        }

        // FIADO
        function addManualDebt() {
            const n = document.getElementById('manual-debt-name').value;
            const v = parseFloat(document.getElementById('manual-debt-value').value);
            if(!n || isNaN(v)) return;
            const d = debts.find(x => x.nome.toLowerCase() === n.toLowerCase());
            if(d) d.valor += v; else debts.push({ nome: n, valor: v });
            document.getElementById('manual-debt-name').value = '';
            document.getElementById('manual-debt-value').value = '';
            save(); renderDebts();
        }

        function renderDebts() {
            document.getElementById('debt-list').innerHTML = debts.map((d,i) => `
                <tr>
                    <td><b>${d.nome}</b></td>
                    <td>R$ <input type="number" step="0.01" value="${d.valor.toFixed(2)}" onchange="debts[${i}].valor=parseFloat(this.value);save()" style="width:100px; font-weight:700; color:red; border:1px solid #eee;"></td>
                    <td style="text-align:right;">
                        <button class="btn btn-success" style="padding:5px 10px; font-size:0.6rem;" onclick="debts.splice(${i},1);save();renderDebts()">QUITAR</button>
                    </td>
                </tr>
            `).join('');
        }

        // POS CORE
        function doSearch(v) {
            const res = document.getElementById('pos-results');
            if(!v) { res.innerHTML = ''; return; }
            const m = prods.filter(p => p.nome.toLowerCase().includes(v.toLowerCase()) || p.id.includes(v));
            res.innerHTML = m.map(p => `<div style="padding:12px; border-bottom:1px solid #eee; cursor:pointer" onclick="addToCart('${p.id}')">${p.nome} - R$ ${p.venda.toFixed(2)}</div>`).join('');
        }

        function addToCart(id) {
            const p = prods.find(x => x.id === id);
            const inC = cart.find(x => x.id === id);
            if(inC) inC.q++; else cart.push({...p, q: 1});
            document.getElementById('pos-results').innerHTML = '';
            document.getElementById('pos-search').value = '';
            renderCart();
        }

        function renderCart() {
            let t = 0;
            document.getElementById('pos-cart').innerHTML = cart.map((c,i) => {
                t += c.venda * c.q;
                return `<tr><td>${c.nome}</td><td>${c.venda.toFixed(2)}</td><td><input type="number" value="${c.q}" onchange="cart[${i}].q=parseInt(this.value);renderCart()" style="width:40px"></td><td>${(c.venda*c.q).toFixed(2)}</td><td><button onclick="cart.splice(${i},1);renderCart()" style="border:none; background:none; color:red; cursor:pointer">X</button></td></tr>`;
            }).join('');
            document.getElementById('pos-total').innerText = `R$ ${t.toFixed(2)}`;
        }

        function openPayModal() { if(cart.length) document.getElementById('pay-modal').style.display = 'flex'; }
        function closeModal() { document.getElementById('pay-modal').style.display = 'none'; }

        function completeSale(type) {
            let brt = 0, luc = 0, items = [];
            let cli = type === 'Fiado' ? prompt("Nome do Cliente:") : 'Geral';
            if(type === 'Fiado' && !cli) return;

            cart.forEach(c => {
                const o = prods.find(x => x.id === c.id);
                if(o) o.qtd -= c.q;
                brt += c.venda * c.q;
                luc += (c.venda - (o ? o.custo : 0)) * c.q;
                items.push(`${c.q}x ${c.nome}`);
            });

            if(type === 'Fiado') {
                const d = debts.find(x => x.nome.toLowerCase() === cli.toLowerCase());
                if(d) d.valor += brt; else debts.push({ nome: cli, valor: brt });
            }

            sales.push({ d: new Date().toLocaleString(), items: items.join(', '), t: brt, l: luc, type: type });
            cart = []; save(); renderCart(); closeModal(); alert("Venda Finalizada!");
        }

        function renderStock() {
            document.getElementById('stock-list').innerHTML = prods.map((p,i) => `<tr><td>${p.id}</td><td><input type="text" value="${p.nome}" onchange="prods[i].nome=this.value;save()"></td><td><input type="number" value="${p.custo}" onchange="prods[i].custo=parseFloat(this.value);save()"></td><td><input type="number" value="${p.venda}" onchange="prods[i].venda=parseFloat(this.value);save()"></td><td><input type="number" value="${p.qtd}" onchange="prods[i].qtd=parseInt(this.value);save()"></td><td><button onclick="prods.splice(${i},1);save();renderStock()" style="color:red; border:none; background:none; cursor:pointer">Excluir</button></td></tr>`).join('');
        }

        function renderHistory() {
            let b = 0, l = 0;
            document.getElementById('hist-list').innerHTML = sales.slice().reverse().map((s,i) => {
                b += s.t; l += s.l;
                return `<tr><td>${s.d}</td><td style="font-size:0.7rem">${s.items}</td><td>${s.t.toFixed(2)}</td><td>${s.type}</td><td><button onclick="sales.splice(${sales.length-1-i},1);save();renderHistory()" style="color:red; border:none; background:none; cursor:pointer">X</button></td></tr>`;
            }).join('');
            document.getElementById('fat-bruto').innerText = `R$ ${b.toFixed(2)}`;
            document.getElementById('fat-lucro').innerText = `R$ ${l.toFixed(2)}`;
        }

        function saveProd() {
            const p = { id: document.getElementById('cad-id').value, nome: document.getElementById('cad-nome').value, custo: parseFloat(document.getElementById('cad-custo').value), venda: parseFloat(document.getElementById('cad-venda').value), qtd: parseInt(document.getElementById('cad-qtd').value) };
            prods.push(p); save(); alert("Cadastrado!");
        }

        function save() {
            localStorage.setItem('mt_p', JSON.stringify(prods));
            localStorage.setItem('mt_v', JSON.stringify(sales));
            localStorage.setItem('mt_f', JSON.stringify(debts));
        }

        function exportDados() {
            const b = new Blob([JSON.stringify({p:prods, v:sales, f:debts})], {type:'application/json'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(b);
            a.download = `MT-BACKUP.json`;
            a.click();
        }

        function importDados(e) {
            const r = new FileReader();
            r.onload = (ev) => {
                const d = JSON.parse(ev.target.result);
                prods = d.p; sales = d.v; debts = d.f;
                save(); location.reload();
            };
            r.readAsText(e.target.files[0]);
        }

        const cols = ['#6366f1', '#10b981', '#f43f5e', '#f59e0b', '#06b6d4', '#ec4899', '#8b5cf6', '#1e293b'];
        cols.forEach(c => {
            const d = document.createElement('div');
            d.style.height = '40px'; d.style.background = c; d.style.borderRadius = '8px'; d.style.cursor = 'pointer';
            d.onclick = () => { document.documentElement.style.setProperty('--primary', c); localStorage.setItem('mt_t', c); };
            document.getElementById('color-grid').appendChild(d);
        });
        if(localStorage.getItem('mt_t')) document.documentElement.style.setProperty('--primary', localStorage.getItem('mt_t'));
    </script>
</body>
</html>